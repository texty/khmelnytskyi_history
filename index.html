<!DOCTYPE html>
        <html lang="en">
          <head>
            <meta charset="utf-8">
            <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
            <title>Хмельницький</title>

            <!-- Leaflet -->

            <link rel="stylesheet" href="libs/leaflet.css" />
            <script src="libs/leaflet.js"></script>
            <script src="libs/leaflet.ajax.min.js"></script>
            <script src="libs/jquery-3.3.1.js"></script>



              <style>
                body { margin:0; padding:0; }
                body, table, tr, td, th, div, h1, h2, input {  font-size: 11pt; }

                #viz {
                    display: grid;
                    grid-template-columns: 60% 40%;
                }

                #nav {
                    width: 100%;
                    /*display: flex;*/
                    /*justify-content: space-between;*/
                }

                #nav p {
                    cursor: pointer;
                    font-size:22px;
                    margin-left: 50px;
                }

                .change_period.active {
                    font-weight: bold;
                    color: #CE4066;
                }

                #map-wrapper {
                    width: 100%;
                    min-height: 100vh;
                    position:relative;
                }

                #map { position:absolute; top:0; bottom:0; width:100%; } /* full size */
                .ctl {
                    padding: 2px 10px 2px 10px;
                    background: white;
                    background: rgba(255,255,255,0.9);
                    box-shadow: 0 0 15px rgba(0,0,0,0.2);
                    border-radius: 5px;
                    text-align: right;
                }
                .title {
                    font-size: 18pt;
                    font-weight: bold;
                }
                .src {
                    font-size: 10pt;
                }

            </style>

        </head>
        <body>


        <div id="viz">

            <div id="map-wrapper">
                <div id="map"></div>
            </div>

            <div id="nav">
                <p id="step_1" data-stuff='["step_800_850_1", "none"]' class="change_period active">1800-1850(1)</p>
                <p id="step_2" data-stuff='["step_800_850_2", "step_800_850_1"]' class="change_period">1800-1850(2)</p>
                <p id="step_3" data-stuff='["step_850_900_1", "step_800_850_2"]' class="change_period">1850-1900(1)</p>
                <p id="step_4" data-stuff='["step_900_921_1", "step_850_900_1"]' class="change_period">1900-1921(1)</p>
                <p id="step_5" data-stuff='["step_921_940_1", "step_900_921_1"]' class="change_period">1921-1945(1)</p>
                <p id="step_6" data-stuff='["step_940_960_1", "step_921_940_1"]' class="change_period">1945-1960(1)</p>
                <p id="step_7" data-stuff='["step_960_970_1", "step_940_960_1"]' class="change_period">1960-1970(1)</p>
                <p id="step_8" data-stuff='["step_970_980_1", "step_960_970_1"]' class="change_period">1970-1980(1)</p>
                <p id="step_9" data-stuff='["step_980_990_1", "step_970_980_1"]' class="change_period">1980-1990(1)</p>
                <p id="step_10" data-stuff='["step_991_1", "step_980_990_1"]' class="change_period">1990+(1)</p>
            </div>


        </div>

        <script>
        /* **** Leaflet **** */




        var attrib = 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.'


        // Map
        var map = L.map('map', {
            center: [49.4183008183, 26.9870752526],
            zoom: 14,
            minZoom: 5,
            maxZoom: 17,
            //autoZIndex: false,
            scrollWheelZoom: false
        });


        //set layers order (оце, мабуть, вже не треба, бо відмовились від старих карт
        map.createPane('oldmaps');
        map.createPane('builgings');


        //add canvas renderer to builgings pane
        var buildingsRenderer = L.canvas({ padding: 0.5, pane: 'builgings' });


        var basemap = L.tileLayer('http://{s}.tile.stamen.com/toner-lite/{z}/{x}/{y}.png', {
            attribution: attrib}).addTo(map);


        /*створюємо шари на всі scrolling steps */
        var step_800_850_1 = new L.LayerGroup(), step_800_850_2 = new L.LayerGroup(), step_800_850_3 = new L.LayerGroup();
        var step_850_900_1 = new L.LayerGroup(), step_850_900_2 = new L.LayerGroup(), step_850_900_3 = new L.LayerGroup();
        var step_900_921_1 = new L.LayerGroup(), step_900_921_2 = new L.LayerGroup(), step_900_921_3 = new L.LayerGroup();
        var step_921_940_1 = new L.LayerGroup(), step_921_940_2 = new L.LayerGroup(), step_921_940_3 = new L.LayerGroup();
        var step_940_960_1 = new L.LayerGroup(), step_940_960_2 = new L.LayerGroup(), step_940_960_3 = new L.LayerGroup();
        var step_960_970_1 = new L.LayerGroup(), step_960_970_2 = new L.LayerGroup(), step_960_970_3 = new L.LayerGroup();
        var step_970_980_1 = new L.LayerGroup(), step_970_980_2 = new L.LayerGroup(), step_970_980_3 = new L.LayerGroup();
        var step_980_990_1 = new L.LayerGroup(), step_980_990_2 = new L.LayerGroup(), step_980_990_3 = new L.LayerGroup();
        var step_991_1 = new L.LayerGroup(), step_991_2 = new L.LayerGroup(), step_991_3 = new L.LayerGroup();


        //новий стиль, задаємо для шарів, які зараз неактивні
        var pastStyle = {
            opacity: 0.5,
            fillOpacity: 0.3
        };

        var mouseoverStyle = { color: "grey", weight: 3 };
        var mouseleaveStyle = { color: "transparent" };

        //це якщо треба додати можливість вмикати/вимикати шари
        //var layerControl = L.control.layers().addTo(map);
        //layerControl.addOverlay(buldings_900_921, "buldings_900_921");


        // плани різних років з тайлів (поки не треба)
//        var p_800 = L.tileLayer('./tiles/plan_1800/{z}/{x}/{y}.png', {tms: true, opacity: 0.9, attribution: "",  pane: 'oldmaps'});
//        var p_944 = L.tileLayer('./tiles/plan_1944/{z}/{x}/{y}.png', {tms: true, opacity: 0.9, attribution: "",  pane: 'oldmaps'});
//        var p_888 = L.tileLayer('./tiles/plan_1888/{z}/{x}/{y}.png', {tms: true, opacity: 0.9, attribution: "",  pane: 'oldmaps'});


        var buildingsColor = "#9d2f32", //"#f14633", //"#9d2f32",
                polygonsFillColor = "#D1E7E0", //"#899e91", //"#bbcda9", // "#fce0bc", //"#899e91", //"#a79d70",
                linesColor = "#0062A6", //'#4783fe',
                pointsColor = "#ff9d04"; //'#D7A319';


        var polygonsFillStyle = {
            weight: 1,
            fillOpacity: 0.7,
            opacity: 1,
            fillColor: polygonsFillColor,
            color: polygonsFillColor
        };

        var polygonsColorStyle = {
            weight: 2,
            opacity: 1,
            fillColor:"transparent",
            color: '#374969',
            dashArray: '5, 5',
            dashOffset: '0'
        };

        var buildingsStyle = {
            weight: 1,
            fillColor: buildingsColor,
            fillOpacity: 0.6,
            color: buildingsColor,
            opacity: 1
        };


        var geojsonMarkerOptions = {
            radius: 4,
            fillColor: pointsColor,
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        };

        function filterBuildingsByPeriod(data, property, period, popup, style){
            return L.geoJson(data, {
                filter: function(feat) { return feat.properties[property] == period},
                renderer: buildingsRenderer,
                style: function(){ return  style },
                onEachFeature: onEachFeatureClosure(buildingsColor, 1)
            }).bindPopup(popup);
        }

        function filterPoligonsByPeriod(data, property, period, popup, style){
            return L.geoJson(data, {
                filter: function(feat) { return feat.properties[property] == period},
                renderer: buildingsRenderer,
                style: function(){ return  style }
               // onEachFeature: onEachFeatureClosure(buildingsColor, 1)
            }).bindPopup(popup);
        }


        function filterLinesByPeriod(data, streetlist, popup){
            return L.geoJson(data, {
                filter: function(feat) { return  streetlist.includes(feat.properties["name"]) },
                renderer: buildingsRenderer,
                style: function(){ return  { "color": linesColor, 'opacity': 1 } },
                onEachFeature: onEachFeatureClosure("blue", 3)
            }).bindPopup(popup);
        }


        function filterPointsByPeriod(data, property, period, popup){
            return L.geoJson(data, {
                filter: function(feat) { return feat.properties[property] == period},
                renderer: buildingsRenderer,
                onEachFeature: onEachFeatureClosure("green", 1),
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, geojsonMarkerOptions);
                }
            }).bindPopup(popup);
        }

        fetch("data/polygonsData_4326_fill.geojson")
                .then(function (response) { return response.json() })
                .then(function (data) {
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "-1800", "polygon", polygonsFillStyle).addTo(step_800_850_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1850-1900", "polygon", polygonsFillStyle).addTo(step_850_900_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1900-1921", "polygon", polygonsFillStyle).addTo(step_900_921_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1921-1940", "polygon", polygonsFillStyle).addTo(step_921_940_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1940-1960", "polygon", polygonsFillStyle).addTo(step_940_960_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1960-1970", "polygon", polygonsFillStyle).addTo(step_960_970_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1970-1980", "polygon", polygonsFillStyle).addTo(step_970_980_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1980-1990", "polygon", polygonsFillStyle).addTo(step_980_990_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1980-1990", "polygon", polygonsFillStyle).addTo(step_980_990_1);
                });


        fetch("data/polygonsData_4326_color.geojson")
                .then(function (response) { return response.json() })
                .then(function (data) {
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "-1800", "polygon", polygonsColorStyle).addTo(step_800_850_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1850-1900", "polygon", polygonsColorStyle).addTo(step_850_900_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1900-1921", "polygon", polygonsColorStyle).addTo(step_900_921_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1921-1940", "polygon", polygonsColorStyle).addTo(step_921_940_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1940-1960", "polygon", polygonsColorStyle).addTo(step_940_960_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1960-1970", "polygon", polygonsColorStyle).addTo(step_960_970_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1970-1980", "polygon", polygonsColorStyle).addTo(step_970_980_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1980-1990", "polygon", polygonsColorStyle).addTo(step_980_990_1);
                    filterPoligonsByPeriod(data, "Data polygonsData_period", "1980-1990", "polygon", polygonsColorStyle).addTo(step_980_990_1);
                });


        fetch("data/osmData_4326.geojson")
            .then(function (response) { return response.json() })
            .then(function (data) {
                filterBuildingsByPeriod(data, "Data osmData_period", "1800-1850", "bulding", buildingsStyle).addTo(step_800_850_1);
                filterBuildingsByPeriod(data, "Data osmData_period", "1850-1900", "bulding", buildingsStyle).addTo(step_850_900_1);
                filterBuildingsByPeriod(data, "Data osmData_period", "1900-1921", "bulding", buildingsStyle).addTo(step_900_921_1);
                filterBuildingsByPeriod(data, "Data osmData_period", "1921-1940", "bulding", buildingsStyle).addTo(step_921_940_1);
                filterBuildingsByPeriod(data, "Data osmData_period", "1940-1960", "bulding", buildingsStyle).addTo(step_940_960_1);
                filterBuildingsByPeriod(data, "Data osmData_period", "1960-1970", "bulding", buildingsStyle).addTo(step_960_970_1);
                filterBuildingsByPeriod(data, "Data osmData_period", "1970-1980", "bulding", buildingsStyle).addTo(step_970_980_1);
                filterBuildingsByPeriod(data, "Data osmData_period", "1980-1990", "bulding", buildingsStyle).addTo(step_980_990_1);
                filterBuildingsByPeriod(data, "Data osmData_period", "1991-", "bulding", buildingsStyle).addTo(step_991_1);
            });


        fetch("data/linesData_4326.geojson")
                .then(function (response) { return response.json() })
                .then(function (data) {
                    filterLinesByPeriod(data, ["Шлях на Кам'янець", "Шлях на Летичів"], "line").addTo(step_800_850_1);
                    filterLinesByPeriod(data,["Вул. Кам'янецька", "вул. Ремісницька", "вул. Соборна", "вул. Набережна", "вул. Аптекарська", "вул. Старобульварна", "вул. Коммерційна", "вул. Купецька", "Вул. Дворянська"], "line").addTo(step_800_850_2);
                });


        fetch("data/pointsData_4326.geojson")
                .then(function (response) { return response.json() })
                .then(function (data) {
                    filterPointsByPeriod(data, "Data pointsData_period", "-1800", "point").addTo(step_800_850_1);
                    filterPointsByPeriod(data, "Data pointsData_period", "1800-1850", "point").addTo(step_800_850_1);
                    filterPointsByPeriod(data, "Data pointsData_period", "1850-1900", "point").addTo(step_850_900_1);
                    filterPointsByPeriod(data, "Data pointsData_period", "1900-1921", "point").addTo(step_900_921_1);






                });



//        function getColor(d) { return d > 1980 ? 'green' :  d > 1950  ? 'red' :  'blue'; }
//
//        function buildingsStyle(feature) {
//           return {
//               fillColor: getColor(feature.properties["Data osmData_StartYear"]),
//               weight: 1,
//               color: getColor(feature.properties["Data osmData_StartYear"]),
//               fillOpacity: 0.5  };
//        }


        //щоб передати змнну у кожен клік
        function onEachFeatureClosure(defaultColor, weightValue) {
            return function onEachFeature(feature, layer) {
                layer.on('mouseover', function (e) {  e.target.setStyle(mouseoverStyle); });
                layer.on('mouseout', function (e) {  e.target.setStyle({ color: defaultColor, weight: weightValue }); });
            }
        }



        step_800_850_1.addTo(map);


       // міняємо періоди по кліку
        $(".change_period").on("click", function(){
            $(".change_period").removeClass("active");
            $(this).addClass("active");
            let myarray = $(this).data('stuff');
            eval(myarray[0]).addTo(map);

            if(myarray[1] != "none"){
                eval(myarray[1]).eachLayer(function(layer) {
                    layer.setStyle(pastStyle);
                });
            }
        });







     </script>
  </body>
</html>

        
